<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>é‹å‹•æ‰“å¡ App - é¦–é </title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header class="app-header">
            <h1>é‹å‹•æ‰“å¡ ç¤¾ç¾¤ç‰†</h1>
        </header>

        <section class="feed">
            <div style="display:flex; justify-content:flex-end; margin-bottom:8px; gap:8px; align-items:center;">
                <a href="{{ url_for('notifications_page') }}" class="nav-item">ğŸ”” é€šçŸ¥{% if unread_count and unread_count>0 %} (<span id="unread-count">{{ unread_count }}</span>){% endif %}</a>
            </div>
            {% for post in posts %}
            <article class="post" data-post-id="{{ post.id }}">
                <div class="post-header" style="position:relative;">
                    <div style="display:flex; align-items:center; gap:8px;">
                        {% if post.avatar %}
                            <img src="{{ post.avatar }}" class="avatar" alt="avatar">
                            {% if post.pinned_badges and post.pinned_badges|length > 0 %}
                                <span class="avatar-badges">
                                {% for b in post.pinned_badges %}
                                    <img src="{{ b }}" alt="badge" class="avatar-badge">
                                {% endfor %}
                                </span>
                            {% endif %}
                        {% else %}
                            <div class="avatar placeholder">{{ post.user[0]|upper }}</div>
                        {% endif %}
                        {% if post.visibility and post.visibility == 'friends' %}
                            <span title="åƒ…å¥½å‹å¯è¦‹" style="font-size:0.9em;color:#999; margin-left:6px;">ğŸ”’</span>
                        {% endif %}
                        <strong class="post-user">{{ post.user }}</strong>
                    </div>
                    <span class="post-time">{{ post.created_at }}</span>
                    <!-- post menu (edit/delete) -->
                    {% if current_user.is_authenticated and current_user.username == post.username %}
                    <div class="post-menu" data-post-id="{{ post.id }}">
                        <button class="post-menu-btn" aria-label="æ›´å¤šé¸é …">â‹¯</button>
                        <ul class="post-menu-list" style="display:none;">
                            <li class="post-menu-edit"><a href="{{ url_for('edit_post', post_id=post.id) }}">ç·¨è¼¯</a></li>
                            <li class="post-menu-delete"><button class="post-menu-delete-btn">åˆªé™¤</button></li>
                        </ul>
                    </div>
                    {% endif %}
                </div>
                <div class="post-body">
                    <p><strong>{{ post.sport }}</strong> â€¢ {{ post.minutes }} åˆ†é˜</p>
                    {% if post.message %}
                    <p class="post-message">{{ post.message_html|safe if post.message_html else post.message }}</p>
                    {% endif %}
                    {% if post.image %}
                        <img src="{{ post.image }}" class="post-image">
                    {% endif %}
                    {% if post.original %}
                        <div class="shared-original">
                            <div style="display:flex; align-items:center; gap:8px;">
                                {% if post.original.avatar %}
                                    <img src="{{ post.original.avatar }}" class="avatar" alt="avatar">
                                {% else %}
                                    <div class="avatar placeholder">{{ post.original.user[0]|upper }}</div>
                                {% endif %}
                                <strong>{{ post.original.user }}</strong>
                            </div>
                            <div style="margin-top:8px; padding:8px; border:1px solid #eef6ff; border-radius:6px; background:#fafcff;">
                                {% if post.original.sport %}<div><strong>{{ post.original.sport }}</strong> â€¢ {{ post.original.minutes }} åˆ†é˜</div>{% endif %}
                                {% if post.original.message %}<div>{{ post.original.message }}</div>{% endif %}
                                {% if post.original.image %}<img src="{{ post.original.image }}" class="post-image" style="max-width:120px; display:block; margin-top:8px;">{% endif %}
                            </div>
                        </div>
                    {% endif %}
                </div>
                <div class="post-actions">
                    {% if current_user.is_authenticated and current_user.username == post.username %}
                        <!-- ç·¨è¼¯/åˆªé™¤å·²ç§»è‡³å³ä¸Šè§’é¸å–® -->
                    {% endif %}
                    <button class="like-btn btn small {% if post.liked %}liked{% endif %}" data-post-id="{{ post.id }}">ğŸ‘ <span class="like-count">{{ post.likes }}</span></button>
                    <button class="comment-toggle btn small" data-post-id="{{ post.id }}">ğŸ’¬ ç•™è¨€ ({{ post.comments|length }})</button>
                    <button class="share-btn btn small" data-post-id="{{ post.id }}">ğŸ” åˆ†äº«</button>
                </div>
                <div class="comments" id="comments-{{ post.id }}" style="display:none;">
                    <ul class="comment-list">
                        {% for c in post.comments %}
                        <li><strong>{{ c.user }}</strong>: {{ c.text }} <span class="c-time">{{ c.time }}</span></li>
                        {% endfor %}
                    </ul>
                    <form class="comment-form" data-post-id="{{ post.id }}">
                        <input type="text" name="text" placeholder="å¯«ä¸‹ä½ çš„ç•™è¨€..." required class="input-small">
                        <button type="submit" class="btn small">é€å‡º</button>
                    </form>
                </div>
            </article>
            {% else %}
            <p>ç›®å‰é‚„æ²’æœ‰è²¼æ–‡ï¼Œå¿«å»æ–°å¢ä½ çš„ç¬¬ä¸€ç¯‡æ‰“å¡è²¼æ–‡ï¼</p>
            {% endfor %}
        </section>
    </div>

    <!-- Bottom nav (7 items) -->
    <div class="bottom-nav">
        <a href="{{ url_for('index') }}" class="nav-item">é¦–é </a>
        <a href="{{ url_for('friends_page') }}" class="nav-item">å¥½å‹</a>
        <a href="{{ url_for('profile_page') }}" class="nav-item">å€‹äºº</a>
        <a href="{{ url_for('checkin') }}" class="nav-item checkin-btn">æ‰“å¡</a>
        <a href="{{ url_for('leaderboard_page') }}" class="nav-item">æ’è¡Œæ¦œ</a>
        <a href="{{ url_for('stats') }}" class="nav-item">åˆ†æ</a>
        <a href="{{ url_for('badges_page') }}" class="nav-item">å¾½ç« </a>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
